# 要件定義書

## 1. プロジェクト概要

### 1.1 背景
FFmpegは動画・音声・画像処理における最も強力なCLIツールだが、コマンドの構文が複雑で初心者にはハードルが高い。GUIでオプションを選択するだけで正しいFFmpegコマンドを生成できるWebアプリがあれば、幅広いユーザーが恩恵を受けられる。

### 1.2 目的
- FFmpegコマンドをGUIで簡単に生成できるWebアプリを提供する
- プリセット（よくある変換パターン）とカスタムフォーム（詳細設定）のハイブリッド型で、初心者から上級者まで対応する
- 生成されたコマンドをコピーして、ユーザーのローカル環境で実行できるようにする

### 1.3 対象ユーザー
- **初心者**: FFmpegを使いたいがコマンドがわからないユーザー → プリセットモードを利用
- **中級者**: 基本は理解しているが効率化したいユーザー → プリセットをカスタマイズして利用
- **上級者**: 細かいパラメータを自分で制御したいユーザー → アドバンスドモードを利用

---

## 2. 機能要件

### 2.1 プリセットモード
よくある変換パターンをカード形式で表示し、ワンクリックで選択できる。

| ID | プリセット名 | 説明 |
|----|-------------|------|
| 1 | 動画フォーマット変換 | MP4↔WebM↔MOV↔AVI間の変換 |
| 2 | 動画圧縮 | ファイルサイズ削減（CRF/ビットレート指定） |
| 3 | 音声抽出 | 動画から音声のみを抽出（MP3/AAC/WAV/FLAC） |
| 4 | 音声変換 | 音声フォーマット間の変換 |
| 5 | 動画トリム | 開始/終了時刻を指定して切り出し |
| 6 | GIF生成 | 動画からアニメーションGIFを生成（パレット付き高品質） |
| 7 | 画像変換・リサイズ | 画像のフォーマット変換、リサイズ、品質調整 |

各プリセットは以下を含む:
- デフォルトパラメータ
- ユーザーが編集可能なフィールドの定義
- 説明テキスト

### 2.2 アドバンスドモード
全パラメータを自由に設定できるフォーム。

- **入力設定**: ファイル名（拡張子指定）
- **出力設定**: ファイル名、フォーマット
- **映像設定**: コーデック、解像度、フレームレート、ビットレート、CRF
- **音声設定**: コーデック、サンプルレート、チャンネル数、ビットレート
- **フィルタ設定**: スケール、クロップ、回転
- **その他**: メタデータ削除、開始/終了時刻

### 2.3 コマンド出力
- 生成されたFFmpegコマンドをリアルタイムで表示
- ワンクリックでクリップボードにコピー
- コマンドのシンタックスハイライト表示

### 2.4 ダークモード
- ライト/ダークの切替トグル
- OSの設定に応じた初期テーマ
- ユーザーの選択をローカルストレージに保存

### 2.5 多言語対応（i18n）
- 日本語・英語の切替
- ブラウザの言語設定に応じた初期言語
- ユーザーの選択をローカルストレージに保存

---

## 3. 非機能要件

### 3.1 レスポンシブデザイン
- デスクトップ、タブレット、モバイルに対応
- モバイルでも快適に操作できるUI

### 3.2 パフォーマンス
- 初回ロード: 3秒以内
- コマンド生成: リアルタイム（入力変更時に即座に反映）
- Lighthouse Performance スコア 90以上を目標

### 3.3 ブラウザ対応
- Chrome, Firefox, Safari, Edge の最新2バージョン

### 3.4 アクセシビリティ
- キーボード操作対応
- 適切なARIAラベル
- 十分なコントラスト比

---

## 4. 対応FFmpeg操作一覧

### 4.1 フォーマット変換
- 対応フォーマット: MP4, WebM, MOV, AVI, MKV, FLV
- コーデック指定: H.264, H.265/HEVC, VP8, VP9, AV1

### 4.2 動画圧縮
- CRF（Constant Rate Factor）による品質指定
- 目標ビットレート指定
- 2パスエンコード対応

### 4.3 音声操作
- 音声抽出: 動画 → MP3/AAC/WAV/FLAC/OGG
- 音声変換: フォーマット間変換
- 音声コーデック: AAC, MP3, Opus, Vorbis, FLAC, PCM

### 4.4 トリム（切り出し）
- 開始時刻 + 終了時刻指定
- 開始時刻 + 持続時間指定
- コピーモード（再エンコードなし）対応

### 4.5 GIF生成
- 基本GIF変換
- パレット生成 + 2パス変換（高品質）
- FPS、解像度指定

### 4.6 画像操作
- フォーマット変換: PNG, JPEG, WebP, AVIF, TIFF, BMP
- リサイズ: 幅/高さ指定、アスペクト比維持
- 品質設定

---

## 5. 技術スタック

| カテゴリ | 技術 |
|---------|------|
| フレームワーク | SvelteKit + TypeScript |
| スタイリング | Tailwind CSS v4 |
| UIコンポーネント | shadcn-svelte |
| 国際化 | sveltekit-i18n |
| テスト | Vitest |
| デプロイ | Vercel |

---

## 6. 将来拡張

- **FFmpeg.wasm**: ブラウザ内でFFmpegを実行し、実際の変換処理を可能にする
- **バックエンド追加**: ファイルアップロード・処理・ダウンロード機能
- **コマンド履歴**: 過去に生成したコマンドの保存・再利用
- **共有機能**: 生成したコマンドをURLで共有
- **プリセット追加**: ユーザーからのリクエストに応じてプリセットを拡充
